#summary Guidelines for using dbdeploy successfully
#labels Featured

= Introduction =

Read GettingStarted for an overview of what dbdeploy does technically.  This page contains guidelines to help you get the right techniques and processes around dbdeploy.

= Guidelines =

  # Treat all database code like any other source code - store it under version control
  # Follow all the normal continuous integration rules: test before checkin, apply your change scripts to a database on a continuous integration server
  # Once a delta script has been checked it don't modify it - if it's wrong write a new change script that fixes it (see FixingABrokenChangeScript)
  # Don't put any transaction handling in your change scripts. dbdeploy wraps your change script in a transaction.
  # If your change script includes DDL (CREATE, ALTER etc) *only include one DDL statement in each script*.  You can break this rule if you must, but it makes recovery much more complicated as if there is an error applying the script you must manually undo the previous steps.  Multiple DML statements (UPDATE, INSERT etc) are ok as they are run transactionally. 
  # Make sure that *every* database modification is written as a delta script to be picked up by dbdeploy.  If you manually hack in changes you will then have problems keeping all your databases in sync causing errors later.
  # Follow the naming convention for delta scripts. Script names must begin with a number that indicates the order in which it should be run (1.sql gets run first, then 2.sql and so on). It's strongly recommended to use the rest of the filename to describe what the script does, e.g. `001_create_test_table.sql`
  # You can optionally add an undo section to your script. Write the script so it performs the do action first. Once all do actions have been scripted include the token â€“//@UNDO on a new line. Include the undo steps after this token.  NB: this feature isn't as useful as it sounds as in the author's experience many scripts are not easily undoable (DROP TABLE for example).  If you choose to use this feature make sure you have a comprehensive test process to prove the undo scripts actually work.

